<!DOCTYPE HTML>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="/ChronicallyHealthy/sidebar.css">
<style>
body {font-family: "Lato", sans-serif;}

  
.warningStyle {
  font-size: 36px;
  font-weight: bold;
  color: #000000;
  padding: 0px 10px;
  background-color:#F2807C;
  margin-left: 15%;
  
}
</style>
  <script type="text/javascript" src="canvasjs.min.js"></script>
  <script type="text/javascript">
    function unhealthyTrend(){
      document.getElementById("warning").innerHTML = 
        "Warning! An unhealthy weight trend has been detected. Please contact your physician. Click here for more information";
      alert("Warning! An unhealthy weight trend has been detected.");
    }
    function healthyTrend(){
      //element
      var elem = document.getElementById("warningContainer")
      elem.innerHTML = 
        "You have a healthy weight trend. Thank you for monitoring your weight.";
      elem.style.backgroundColor = "#7CF280";
    }
    window.onload = function () {
       //over here, we just read from a file, i.e. this code won't exist once we have the data from another form
      var weightVectorUnhealthy = [-1,-0.2,-0.2,0.2,0.1,-0.05,-0.4,-0.1,-0.2,0,0,0.15,-0.1,0.15,0.2,0.4,0,0,0,0,0.2,0.5,0.5,0,0.7,1,1.1,1.3,1.25,2,2.3];
      for(var i = 0 ; i < weightVectorUnhealthy.length; i++){
          weightVectorUnhealthy[i] = weightVectorUnhealthy[i] + 70;
      }  
  //var flagDate; //healthy
  var flagDate = "Feb 23"; //sick
      //end of section
    
      //get max and min
    var max = weightVectorUnhealthy[0];
    var min = weightVectorUnhealthy[0];
    
      for(var i = 1 ; i < weightVectorUnhealthy.length; i++){
        if(max < weightVectorUnhealthy[i])
          max = weightVectorUnhealthy[i];
        if(min > weightVectorUnhealthy[i])
          min = weightVectorUnhealthy[i];
      }  
    
      var dataSet = new Array(weightVectorUnhealthy.length);

      for(var i = 0 ; i < weightVectorUnhealthy.length; i++){
        var date = "Feb " + (i + 1);
        //dataSet.push({ label: date, value: 1 });
        dataSet[i] = {};
        dataSet[i].label = date;
        dataSet[i].x = i;
        dataSet[i].y = weightVectorUnhealthy[i];
      }  
  	var dataSet2;
      
      
      var deMeaneddataSet = new Array(weightVectorUnhealthy.length);
      
      for(var i = 0 ; i < weightVectorUnhealthy.length; i++){
        var date = "Feb " + (i + 1);
        //dataSet.push({ label: date, value: 1 });
        deMeaneddataSet[i] = {};
        deMeaneddataSet[i].label = date;
        deMeaneddataSet[i].x = i;
        deMeaneddataSet[i].y = weightVectorUnhealthy[i];
      }  
  	var deMeaneddataSet2;
      
      //highlight the unhealthy area
    if (flagDate && flagDate.length) {
      //person IS UNHEALTHY!! COLOUR GRAPH & ALERT
      unhealthyTrend();//change back later to unhealthy
      
            // array and array.length are truthy
      		for(var i = 0 ; i < dataSet.length; i++){
              if(dataSet[i].label == flagDate){
                dataSet2 = dataSet.slice(i, dataSet.length);
                dataSet = dataSet.slice(0, i+1);
                //DEMEANED
                deMeaneddataSet2 = deMeaneddataSet.slice(i, deMeaneddataSet.length);
                deMeaneddataSet = deMeaneddataSet.slice(0, i+1);
              	//exit loop
                i = dataSet.length+1;
              }
            }
        }
      else{
        healthyTrend();
      }
        //*/
    var actualWeightChart = new CanvasJS.Chart("chartContainer",
    {
            axisY:{
              title : "Weight (kg)",
              minimum: min - 1,
              maximum: max + 1
            },
      title: {
        text: "Weight Trend"
      },
        data: [
      {
        type: "area",
        dataPoints: dataSet
      },{
      
        type: "area",
        dataPoints: dataSet2
      }
      ]
    });
      
      
      var avg = 0;
      for (var  i =0; i < weightVectorUnhealthy.length; i++){
        avg += weightVectorUnhealthy[i];
      }
      avg = avg / weightVectorUnhealthy.length;
      avg = Math.round( avg * 10 ) / 10;
      
      for (var  i =0; i < deMeaneddataSet.length; i++){
        deMeaneddataSet[i].y = deMeaneddataSet[i].y - avg;
      }
      
      for (var  i =1; i < deMeaneddataSet2.length; i++){
        deMeaneddataSet2[i].y = deMeaneddataSet2[i].y - avg;
      }
      
      
      var deMeanedChart = new CanvasJS.Chart("chartContainerDeMeaned",
    {
            axisY:{
              title : "Weight (kg)"
            },
      title: {
        text: "Change in Weight"
      },
        data: [
      {
        type: "area",
        dataPoints: deMeaneddataSet
      },{
      
        type: "area",
        dataPoints: deMeaneddataSet2
      }
      ]
    });

    actualWeightChart.render();
    deMeanedChart.render();
  }
    
    
  </script>
</head>
 
<body>
  <div class="sidebar">
    
    <a href="https://bengharachorloo.github.io/ChronicallyHealthy/canvasjs-2.3/weightGraph.html"><i class="fa fa-fw fa-line-chart"></i> Weight Trend</a>
    <a href="https://bengharachorloo.github.io/ChronicallyHealthy/weightHistory.html"><i class="fa fa-fw fa-history"></i> Weight History</a>
    <a href="https://bengharachorloo.github.io/ChronicallyHealthy/preVisitAssessment.html"><i class="fa fa-fw fa-hospital-o"></i> Doctor's Visits</a>
    <a href="https://bengharachorloo.github.io/ChronicallyHealthy/contacts.html"><i class="fa fa-fw fa-envelope"></i> Contacts</a>
    <a href="https://bengharachorloo.github.io/ChronicallyHealthy/about.html"><i class="fa fa-fw fa-info-circle"></i> About</a>
  </div>
    <div id="warningContainer" class = "warningStyle" >
      <div id="warning" style = " text-align: center; ">
        <p>Warning!</p>
        <p>An unhealthy weight trend has been detected. Please contact your physician. Click here for more information</p>
      </div>
    </div>
  <br>
  <br>
  <div style = "margin-left:20%;">
    <div>
      <div id="chartContainer" style="height: 500px; width: 90%;"></div>
      <br>
      <br>
      <div id="chartContainerDeMeaned" style="height: 500px; width: 90%;"></div>
    </div>
  </div>
</body>
</html>
