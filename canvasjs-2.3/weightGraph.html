<!DOCTYPE HTML>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="/ChronicallyHealthy/sidebar.css">
<style>
body {font-family: "Lato", sans-serif;}
  
.warningStyle {
  font-size: 36px;
  font-weight: bold;
  color: #000000;
  padding: 0px 10px;
  background-color:#F2807C;
  margin-left: 15%;
  
}
</style>
  <script type="text/javascript" src="canvasjs.min.js"></script>
  <script type="text/javascript">
    function unhealthyTrend(){
		
		var line1 = "Warning: An unhealthy weight trend has been detected, which may be indicative of edema formation. Please contact your physician.";
		var line2 = "Click here for more information.";
		var para1 = document.createElement("p");
		var para2 = document.createElement("p");
        var line1  = document.createTextNode(line1 );
        var line2  = document.createTextNode(line2);
		
		
		para1.appendChild(line1);
		para2.appendChild(line2);
        var warningElem = document.createElement("div");
	  warningElem.appendChild(para1);
	  warningElem.appendChild(para2);
	  var oldWarningID = document.getElementById("warning");
	  
	  
	  parent = oldWarningID.parentNode;
	  parent.insertBefore(warningElem, oldWarningID);
	  // Remove the original
	  parent.removeChild(oldWarningID);//*/
    }
    function healthyTrend(){
      //element
      var elem = document.getElementById("warningContainer")
      elem.innerHTML = 
        "You have a healthy weight trend. Thank you for monitoring your weight.";
      elem.style.backgroundColor = "#7CF280";
    }
	  function whichColor(healthType){
	if(healthType == "Indeterminate")
    	return "gray"
	if(healthType == "Healthy")
    	return "blue"
	if(healthType == "Unhealthy")
    	return "red"
}
function buildData(weightVector,dateVector,healthTypeVector){
var data = new Array();
	var dataSeries = {};
	dataSeries.type = "area";
	dataSeries.color = whichColor(healthTypeVector[0]);
	dataSeries.dataPoints = new Array();
	dataSeries.dataPoints.push({label:dateVector[0],x:0,y:weightVector[0]});
	data.push(dataSeries);
    j = 0;
	for(var i = 1; i < weightVector.length; i++){
	if (healthTypeVector[i] != healthTypeVector[i-1]){
		data[j].dataPoints.push({label:dateVector[i],x:i,y:weightVector[i]});
		var dataSeries = {};
		dataSeries.type = "area";
		dataSeries.color = whichColor(healthTypeVector[i]);
		dataSeries.dataPoints = new Array();
		dataSeries.dataPoints.push({label:dateVector[i],x:i,y:weightVector[i]});
		data.push(dataSeries);
	    j++;
	}
	else
		data[j].dataPoints.push({label:dateVector[i],x:i,y:weightVector[i]});
	}
	return data
	}
    window.onload = function () {
       //over here, we just read from a file, i.e. this code won't exist once we have the data from another form
      
	 var weightVector= [-1,-0.2,-0.2,1.1,1.3,1.25,2.3];
	for(var i = 0 ; i < weightVector.length; i++){
		weightVector[i] = weightVector[i] + 70;
	}  
	var dateVector = ["Feb 1","Feb 2","Feb 3","Feb 4","Feb 5","Feb 6","Feb 7"];
	var healthTypeVector = ["Healthy","Indeterminate","Healthy","Healthy","Healthy","Unhealthy","Unhealthy"];
		//read the above from a file




	 
	  //get avg
      var avg = 0;
      for (var  i =0; i < weightVector.length; i++){
        avg += weightVector[i];
      }
      avg = avg / weightVector.length;
      avg = Math.round( avg * 10 ) / 10;
      
	  
	  
	  var deMeaned_weightVector = new Array();
	  for (var  i =0; i < weightVector.length; i++){
		deMeaned_weightVector.push(weightVector[i] - avg);
	  }
	var dataSet = buildData(weightVector,dateVector,healthTypeVector);
	  
	var deMeaned_dataSet = buildData(deMeaned_weightVector,dateVector,healthTypeVector);
      //end of section
    
      //get max and min
    var max = weightVector[0];
    var min = weightVector[0];
    
      for(var i = 1 ; i < weightVector.length; i++){
        if(max < weightVector[i])
          max = weightVector[i];
        if(min > weightVector[i])
          min = weightVector[i];
      }  
    
      
      
      
     /* 
      var healthy = true;
      //highlight the unhealthy area
    for(var i = 0; i < healthTypeVector.length; i++){
     if (healthTypeVector[i] == "Unhealthy" ) {
       unhealthyTrend();//change back later to unhealthy
       healthy = false;
	     i = healthTypeVector.length;
     }
    }
	    
      if(healthy){
        healthyTrend();
      }
        //*/
    var actualWeightChart = new CanvasJS.Chart("chartContainer",
    {
            axisY:{
              title : "Weight (kg)",
              minimum: min - 1,
              maximum: max + 1
            },
      title: {
        text: "Weight Trend"
      },
        data: dataSet
    });
      
      
      
      var deMeanedChart = new CanvasJS.Chart("chartContainerDeMeaned",
    {
            axisY:{
              title : "Weight (kg)"
            },
      title: {
        text: "Change in Weight"
      },
        data: deMeaned_dataSet
    });
    actualWeightChart.render();
    deMeanedChart.render();
  }
    
    
  </script>
</head>
 
<body>
  <div class="sidebar">
    
    <a href="http://localhost/ChronicallyHealthy/canvasjs-2.3/weightGraph.php"><i class="fa fa-fw fa-line-chart"></i> Weight Trend</a>
    <a href="http://localhost/ChronicallyHealthy/weightHistory.php"><i class="fa fa-fw fa-history"></i> Weight History</a>
    <a href="http://localhost/ChronicallyHealthy/preVisitAssessment.php"><i class="fa fa-fw fa-hospital-o"></i> Doctor's Visits</a>
    <a href="http://localhost/ChronicallyHealthy/contacts.php"><i class="fa fa-fw fa-envelope"></i> Contacts</a>
    <a href="http://localhost/ChronicallyHealthy/about.php"><i class="fa fa-fw fa-info-circle"></i> About</a>
    <a href="http://localhost/ChronicallyHealthy/userGuide.php"><i class="fa fa-fw fa-question-circle"></i> User Guide</a>
  </div>
    <div id="warningContainer" class = "warningStyle" style = " text-align: center; ">
      <div id="warning" >
        <p>Warning:</p>
        <p>An unhealthy weight trend has been detected, which may be indicative of edema formation. Please contact your physician. Click here for more information.</p>
      </div>
    </div>
  <br>
  <br>
  <div style = "margin-left:20%;">
    <div>
      <div id="chartContainer" style="height: 500px; width: 90%;"></div>
      <br>
      <br>
      <div id="chartContainerDeMeaned" style="height: 500px; width: 90%;"></div>
    </div>
  </div>
</body>
</html>
