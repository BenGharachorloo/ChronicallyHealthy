<!DOCTYPE HTML>
<html>
<head>
  
  <script type="text/javascript" src="canvasjs.min.js"></script>
  <script type="text/javascript">
    function unhealthyTrend(){
      document.getElementById("warning").innerHTML = 
        "Warning! An unhealthy weight trend has been detected. Please contact your physician. Click here for more information";
      alert("Warning! An unhealthy weight trend has been detected.");
    }
    function healthyTrend(){
      
      document.getElementById("warning").innerHTML = 
        "You have a healthy weight trend. Thank you for monitoring your weight.";
    }
    window.onload = function () {
       //over here, we just read from a file, i.e. this code won't exist once we have the data from another form
      var weightVectorUnhealthy = [-1,-0.2,-0.2,0.2,0.1,-0.05,-0.4,-0.1,-0.2,0,0,0.15,-0.1,0.15,0.2,0.4,0,0,0,0,0.2,0.5,0.5,0,0.7,1,1.1,1.3,1.25,2,2.3];
      for(var i = 0 ; i < weightVectorUnhealthy.length; i++){
          weightVectorUnhealthy[i] = weightVectorUnhealthy[i] + 70;
      }  
  //var flagDate; //healthy
  var flagDate = "Feb 23"; //sick
      //end of section
    
      //get max and min
    var max = weightVectorUnhealthy[0];
    var min = weightVectorUnhealthy[0];
    
      for(var i = 1 ; i < weightVectorUnhealthy.length; i++){
        if(max < weightVectorUnhealthy[i])
          max = weightVectorUnhealthy[i];
        if(min > weightVectorUnhealthy[i])
          min = weightVectorUnhealthy[i];
      }  
    
      var dataSet = new Array(weightVectorUnhealthy.length);

      for(var i = 0 ; i < weightVectorUnhealthy.length; i++){
        var date = "Feb " + (i + 1);
        //dataSet.push({ label: date, value: 1 });
        dataSet[i] = {};
        dataSet[i].label = date;
        dataSet[i].x = i;
        dataSet[i].y = weightVectorUnhealthy[i];
      }  
  	var dataSet2;
      var avg = 0;
      for (var  i =0; i < dataSet.length; i++){
        avg += dataSet[i];
      }
      avg = avg / dataSet.length;
      
      //highlight the unhealthy area
    if (flagDate && flagDate.length) {
      //person IS UNHEALTHY!! COLOUR GRAPH & ALERT
      unhealthyTrend();
      
            // array and array.length are truthy
      		for(var i = 0 ; i < dataSet.length; i++){
              if(dataSet[i].label == flagDate){
                dataSet2 = dataSet.slice(i, dataSet.length);
                dataSet = dataSet.slice(0, i+1);
              	//exit loop
                i = dataSet.length+1;
              }
            }
        }
      else{
        healthyTrend();
      }
        //*/
    var actualWeightChart = new CanvasJS.Chart("chartContainer",
    {
            axisY:{
              title : "Weight (kg)",
              minimum: min - 1,
              maximum: max + 1
            },
      title: {
        text: "Weight Trend"
      },
        data: [
      {
        type: "area",
        dataPoints: dataSet
      },{
      
        type: "area",
        dataPoints: dataSet2
      }
      ]
    });
      
      
      for (var  i =0; i < dataSet.length; i++){
        dataSet[i] = dataSet[i] - avg;
      }
      
      for (var  i =0; i < dataSet2.length; i++){
        dataSet2[i] = dataSet2[i] - avg;
      }
      
      var deMeanedChart = new CanvasJS.Chart("chartContainerDeMeaned",
    {
            axisY:{
              title : "Weight (kg)",
              minimum: min - 1,
              maximum: max + 1
            },
      title: {
        text: "Weight Trend"
      },
        data: [
      {
        type: "area",
        dataPoints: dataSet
      },{
      
        type: "area",
        dataPoints: dataSet2
      }
      ]
    });

    actualWeightChart.render();
    deMeanedChart.render();
  }
    
    
  </script>
</head>
 
<body>
  
  <div style = "margin-left:25%;">
    <div id="chartContainer" style="height: 500px; width: 100%;"></div>
    <div id="chartContainerDeMeaned" style="height: 500px; width: 100%;"></div>
  </div>
  <div>
    <br>
    <br>
    <br>
    <div id="warning" style = "text-align: center;">Warning! An unhealthy weight trend has been detected. Please contact your physician. Click here for more information</div>
    <br>
    <br>
    <br>
  </div>
</body>
</html>
